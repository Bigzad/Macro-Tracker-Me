<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered Macro Calculator & Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Simple Logger - Must load first to control logging -->

    
    <!-- Initialization Manager - Must load after console manager -->
    
    
    <!-- Supabase Authentication System -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.min.js"></script>
    
    

    
    
    <!-- Security Middleware - Protects API endpoints -->
    
    
    <!-- UUID-based Auth Helper -->
    
    
    <!-- COMPREHENSIVE ERROR HANDLING SYSTEM -->
    <script src="error-handling-system.js"></script>
    
    <!-- Subscription Management System -->
    <script src="subscription-manager.js"></script>
    <script src="subscription-middleware.js"></script>
    <script src="safe-json-handler.js"></script>
    <script src="database-error-recovery.js"></script>
    <script src="enhanced-database-functions.js"></script>
    


    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .chart-container {
            position: relative;
            height: 120px;
            width: 120px;
        }
        .meal-item {
            transition: all 0.3s ease;
        }
        
        /* Mobile Sidebar Styles */
        .sidebar-open {
            transform: translateX(0) !important;
        }
        
        .sidebar-overlay-visible {
            display: block !important;
        }
        
        /* Prevent body scrolling when sidebar is open */
        .sidebar-no-scroll {
            overflow: hidden;
        }
        
        /* Smooth transitions for sidebar */
        #sidebar-menu {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        #sidebar-overlay {
            transition: opacity 0.3s ease-in-out;
        }
        
        /* Mobile responsive dropdown fixes */
        @media (max-width: 480px) {
            /* Ensure dropdowns are visible on mobile */
            #groceryDropdown, #progressExportDropdown {
                position: absolute !important;
                right: 0 !important;
                left: auto !important;
                top: 100% !important;
                margin-top: 0.25rem !important;
                min-width: 160px !important;
                max-width: calc(100vw - 2rem) !important;
                z-index: 9999 !important;
                background: white !important;
                border: 1px solid #e5e7eb !important;
                border-radius: 0.5rem !important;
                box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04) !important;
            }
            
            /* Make dropdown buttons more touch-friendly on mobile */
            #groceryDropdown button, #progressExportDropdown button {
                min-height: 44px !important;
                padding: 0.75rem 1rem !important;
                font-size: 14px !important;
            }
            
            /* Truncate long text on mobile */
            .truncate {
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
        }
        
        /* Extra small screen adjustments */
        @media (max-width: 375px) {
            /* For iPhone SE and similar small screens */
            .relative .absolute {
                right: 0.5rem !important;
                max-width: calc(100vw - 1rem) !important;
            }
        }
        .meal-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        /* Custom Notification Styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            min-width: 320px;
            max-width: 400px;
            padding: 16px 20px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            transform: translateX(100%);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border-left: 4px solid #047857;
        }
        
        .notification.warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            border-left: 4px solid #b45309;
        }
        
        .notification.error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border-left: 4px solid #b91c1c;
        }
        
        .notification.info {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border-left: 4px solid #1d4ed8;
        }
        
        .notification-icon {
            font-size: 20px;
            margin-right: 12px;
        }
        
        .notification-content {
            display: flex;
            align-items: center;
        }
        
        .notification-text {
            flex: 1;
        }
        
        .notification-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 2px;
        }
        
        .notification-message {
            font-size: 13px;
            opacity: 0.9;
        }
        
        .notification-close {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 0;
            margin-left: 12px;
            opacity: 0.8;
            transition: opacity 0.2s;
        }
        
        .notification-close:hover {
            opacity: 1;
        }
        
        /* Custom Modal Styles */
        .custom-modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1001;
            padding: 20px;
            backdrop-filter: blur(5px);
        }
        
        .custom-modal-content {
            background: white;
            border-radius: 16px;
            padding: 24px;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            transform: scale(0.9);
            animation: modalShow 0.2s ease forwards;
        }
        
        @keyframes modalShow {
            to {
                transform: scale(1);
            }
        }
        
        .modal-icon {
            font-size: 48px;
            text-align: center;
            margin-bottom: 16px;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 8px;
            color: #374151;
        }
        
        .modal-message {
            text-align: center;
            color: #6b7280;
            margin-bottom: 24px;
            line-height: 1.5;
        }
        
        .modal-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }
        
        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .modal-btn-primary {
            background: #ef4444;
            color: white;
        }
        
        .modal-btn-primary:hover {
            background: #dc2626;
        }
        
        .modal-btn-secondary {
            background: #f3f4f6;
            color: #374151;
        }
        
        .modal-btn-secondary:hover {
            background: #e5e7eb;
        }
        
        /* Mobile Responsive Fixes */
        * {
            box-sizing: border-box;
        }
        
        html, body {
            overflow-x: hidden;
            width: 100%;
            max-width: 100vw;
        }
        
        .container {
            width: 100%;
            max-width: 100vw;
            padding-left: 1rem;
            padding-right: 1rem;
            margin: 0 auto;
        }
        
        /* Fix grid overflows on mobile */
        .grid {
            width: 100%;
        }
        
        /* Mobile input fixes */
        input, select, textarea, button {
            max-width: 100%;
            word-wrap: break-word;
        }
        
        /* Notification responsive fixes */
        .notification {
            left: 10px;
            right: 10px;
            width: auto;
            min-width: auto;
            max-width: calc(100vw - 20px);
            transform: translateX(0);
            opacity: 0;
            visibility: hidden;
        }
        
        .notification.show {
            transform: translateX(0);
            opacity: 1;
            visibility: visible;
        }
        
        /* Mobile modal fixes */
        .custom-modal {
            padding: 10px;
        }
        
        .custom-modal-content {
            margin: 0 auto;
            max-width: calc(100vw - 20px);
            width: 100%;
        }
        
        /* Recipe cards mobile fixes */
        .recipe-card {
            width: 100%;
            max-width: 100%;
        }
        
        /* Chart container mobile fixes */
        .chart-container {
            max-width: 100px;
            max-height: 100px;
            margin: 0 auto;
        }
        
        /* Table/grid responsive */
        @media (max-width: 768px) {
            .md\\:grid-cols-2 {
                grid-template-columns: repeat(1, minmax(0, 1fr)) !important;
            }
            
            .md\\:grid-cols-3 {
                grid-template-columns: repeat(1, minmax(0, 1fr)) !important;
            }
            
            .md\\:grid-cols-4 {
                grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
            }
            
            .md\\:grid-cols-5 {
                grid-template-columns: repeat(1, minmax(0, 1fr)) !important;
            }
            
            .md\\:grid-cols-6 {
                grid-template-columns: repeat(1, minmax(0, 1fr)) !important;
            }
            
            .lg\\:grid-cols-2 {
                grid-template-columns: repeat(1, minmax(0, 1fr)) !important;
            }
            
            .lg\\:grid-cols-3 {
                grid-template-columns: repeat(1, minmax(0, 1fr)) !important;
            }
        }
        
        /* Small mobile fixes */
        @media (max-width: 480px) {
            .text-3xl {
                font-size: 1.5rem !important;
            }
            
            .text-2xl {
                font-size: 1.25rem !important;
            }
            
            .p-6 {
                padding: 1rem !important;
            }
            
            .gap-8 {
                gap: 1rem !important;
            }
            
            .gap-6 {
                gap: 0.75rem !important;
            }
            
            .gap-4 {
                gap: 0.5rem !important;
            }
            
            /* Day selection buttons */
            .day-btn {
                font-size: 0.75rem !important;
                padding: 0.5rem 0.75rem !important;
            }
            
            /* Progress bars mobile */
            .chart-container {
                height: 80px !important;
                width: 80px !important;
            }
        }
        
        /* Extra small devices */
        @media (max-width: 360px) {
            .container {
                padding-left: 0.5rem;
                padding-right: 0.5rem;
            }
            
            .text-lg {
                font-size: 1rem !important;
            }
            
            .p-4 {
                padding: 0.75rem !important;
            }
            
            .px-4 {
                padding-left: 0.75rem !important;
                padding-right: 0.75rem !important;
            }
            
            .py-4 {
                padding-top: 0.75rem !important;
                padding-bottom: 0.75rem !important;
            }
        }

        /* Custom Toggle Switch Styles */
        input[type="checkbox"]:checked + div .toggle-dot {
            transform: translateX(16px);
        }
        
        input[type="checkbox"]:checked + div {
            background-color: #3b82f6;
        }

        /* Custom Section Animation */
        .custom-section-transition {
            transition: all 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    
    <!-- Main Application (Protected - Only shown to authenticated users) -->
    <div id="app-section">
        <div class="container mx-auto p-2 sm:p-4 max-w-6xl w-full">
            

        <!-- Top Navigation Bar -->
        <nav class="bg-white shadow-sm border-b border-gray-200 mb-8">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <!-- Left side - Logo and Title -->
                    <div class="flex items-center">
                        <div class="flex-shrink-0 flex items-center">
                            <i class="fas fa-calculator text-purple-600 text-2xl mr-3"></i>
                            <h1 class="text-xl font-bold text-gray-900 hidden sm:block">AI-Powered Macro Calculator</h1>
                            <h1 class="text-lg font-bold text-gray-900 sm:hidden">Macro Calculator</h1>
                        </div>
                    </div>
                    
                    <!-- Right side - Unit Selection, Hamburger Menu -->
                    <div class="flex items-center space-x-4">
                        <!-- Unit Selection (Desktop only) -->
                        <div class="hidden md:block">
                            <select id="unitSystem" onchange="changeUnitSystem()" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg px-3 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="imperial">Imperial (lbs/in)</option>
                                <option value="metric">Metric (kg/cm)</option>
                            </select>
                        </div>
                        
                        <!-- Desktop User Info (Hidden on Mobile) -->
                        <div id="desktop-user-info" class="hidden md:flex items-center space-x-3">
                            <div class="flex items-center space-x-2">
                                <div class="w-8 h-8 bg-purple-600 rounded-full flex items-center justify-center">
                                    <i class="fas fa-user text-white text-sm"></i>
                                </div>
                                <span id="desktop-user-name" class="text-sm font-medium text-gray-700"></span>
                            </div>
                        </div>
                        
                        <!-- Desktop Logout Button (Hidden on Mobile) -->
                        <button id="desktop-auth-button" onclick="handleAuth()" class="hidden md:inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors">
                            <i class="fas fa-sign-out-alt mr-2"></i>Logout
                        </button>
                        
                        <!-- Mobile Hamburger Menu Button -->
                        <button id="hamburger-btn" onclick="toggleSidebar()" class="md:hidden p-2 rounded-lg text-gray-600 hover:text-gray-900 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <i class="fas fa-bars text-xl"></i>
                        </button>
                        
                    </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Mobile Sidebar Menu -->
        <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden md:hidden" onclick="closeSidebar()"></div>
        <div id="sidebar-menu" class="fixed top-0 left-0 w-80 h-full bg-white shadow-xl z-50 transform -translate-x-full transition-transform duration-300 ease-in-out md:hidden">
            <!-- Sidebar Header -->
            <div class="flex items-center justify-between p-6 border-b border-gray-200 bg-gradient-to-r from-purple-600 to-blue-600">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                        <i class="fas fa-calculator text-white text-lg"></i>
                    </div>
                    <h2 class="text-lg font-bold text-white">Macro Calculator</h2>
                </div>
                <button onclick="closeSidebar()" class="p-2 rounded-lg text-white hover:bg-white hover:bg-opacity-20 transition-colors">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <!-- User Profile Section -->
            <div id="sidebar-user-section" class="p-6 border-b border-gray-200 bg-gray-50">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 bg-purple-600 rounded-full flex items-center justify-center">
                        <i class="fas fa-user text-white text-lg"></i>
                    </div>
                    <div>
                        <div id="sidebar-user-name" class="font-medium text-gray-900 text-sm"></div>
                        <div id="sidebar-user-email" class="text-gray-600 text-xs mt-1"></div>
                    </div>
                </div>
            </div>
            
            <!-- Menu Items -->
            <div class="py-4">
                <!-- Unit System Selection -->
                <div class="px-6 py-3 border-b border-gray-100">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Measurement Units</label>
                    <select id="mobile-unit-system" onchange="changeUnitSystemMobile()" class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg px-3 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        <option value="imperial">Imperial (lbs/in)</option>
                        <option value="metric">Metric (kg/cm)</option>
                    </select>
                </div>
                
                <!-- App Info -->
                <div class="px-6 py-4 border-b border-gray-100">
                    <div class="flex items-center space-x-3 text-gray-700">
                        <i class="fas fa-info-circle text-purple-600"></i>
                        <div>
                            <div class="font-medium text-sm">Personalized nutrition planning made simple</div>
                            <div class="text-xs text-gray-500 mt-1">AI-powered macro tracking</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Bottom Actions -->
            <div class="absolute bottom-0 left-0 right-0 p-6 border-t border-gray-200 bg-gray-50">
                <button id="mobile-logout-btn" onclick="handleAuthMobile()" class="w-full flex items-center justify-center px-4 py-3 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors">
                    <i class="fas fa-sign-out-alt mr-2"></i>
                    Logout
                </button>
            </div>
        </div>

        <!-- App Description Banner -->
        <div class="gradient-bg text-white p-4 rounded-lg shadow-lg mb-8">
            <div class="text-center">
                <p class="text-lg opacity-90">Personalized nutrition planning made simple</p>
            </div>
        </div>

        <!-- Mobile Unit Selection -->
        <div class="md:hidden mb-6 bg-white p-4 rounded-lg shadow-sm">
            <label class="block text-sm font-medium text-gray-700 mb-2">
                <i class="fas fa-globe mr-2"></i>Measurement Units
            </label>
            <select id="unitSystemMobile" onchange="changeUnitSystem()" class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg px-3 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                <option value="imperial">Imperial (lbs / inches)</option>
                <option value="metric">Metric (kg / cm)</option>
            </select>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-8">
            <!-- Calculator Section -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">Personal Information</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Age</label>
                        <input type="number" id="age" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="25" min="10" max="100">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Gender</label>
                        <select id="gender" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                        </select>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="weight" class="block text-sm font-medium text-gray-700 mb-2">Weight (lbs)</label>
                        <input type="number" id="weight" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="152.19" min="50" max="500" step="0.1">
                    </div>
                    <div>
                        <label for="height" class="block text-sm font-medium text-gray-700 mb-2">Height (inches)</label>
                        <input type="number" id="height" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="66.9291" min="48" max="84" step="0.1">
                    </div>
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Activity Level</label>
                    <select id="activity" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="1.2">Sedentary (little or no exercise)</option>
                        <option value="1.375">Lightly active (light exercise 1-3 days/week)</option>
                        <option value="1.55" selected>Moderately active (moderate exercise 3-5 days/week)</option>
                        <option value="1.725">Very active (hard exercise 6-7 days/week)</option>
                        <option value="1.9">Extremely active (very hard exercise, physical job)</option>
                    </select>
                </div>

                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Goal</label>
                    <select id="goal" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="-500">Weight Loss (-500 cal/day)</option>
                        <option value="0">Maintain Weight</option>
                        <option value="300">Muscle Gain (+300 cal/day)</option>
                    </select>
                </div>

                <!-- Authentication Status -->
                <div id="auth-status" class="mb-4 text-sm text-gray-600 hidden">
                    <i class="fas fa-info-circle mr-1"></i>
                    <span id="auth-status-text">Checking sync status...</span>
                </div>

                <!-- Load Previous Details Button -->
                <div class="mb-4">
                    <button onclick="loadAndPopulatePersonalInfo(true)" class="w-full bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-2 px-4 rounded-lg transition duration-200 border border-gray-300">
                        <i class="fas fa-history mr-2"></i>Load My Previous Details
                    </button>
                </div>

                <button onclick="calculateMacros()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 transform hover:scale-105">
                    <i class="fas fa-calculator mr-2"></i>Calculate My Macros
                </button>
            </div>

            <!-- Results Section -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">Your Personalized Results</h2>
                
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div class="text-center">
                        <div class="chart-container mx-auto mb-2">
                            <canvas id="caloriesChart"></canvas>
                        </div>
                        <div class="font-bold text-lg text-blue-600" id="dailyCalories">2,000</div>
                        <div class="text-sm text-gray-600">Calories</div>
                    </div>
                    <div class="text-center">
                        <div class="chart-container mx-auto mb-2">
                            <canvas id="proteinChart"></canvas>
                        </div>
                        <div class="font-bold text-lg text-red-500" id="proteinAmount">150g</div>
                        <div class="text-sm text-gray-600">Protein</div>
                    </div>
                    <div class="text-center">
                        <div class="chart-container mx-auto mb-2">
                            <canvas id="carbsChart"></canvas>
                        </div>
                        <div class="font-bold text-lg text-green-500" id="carbsAmount">250g</div>
                        <div class="text-sm text-gray-600">Carbs</div>
                    </div>
                    <div class="text-center">
                        <div class="chart-container mx-auto mb-2">
                            <canvas id="fatChart"></canvas>
                        </div>
                        <div class="font-bold text-lg text-yellow-500" id="fatAmount">67g</div>
                        <div class="text-sm text-gray-600">Fat</div>
                    </div>
                </div>

                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded">
                    <h3 class="font-bold text-yellow-800 mb-2">
                        <i class="fas fa-brain mr-2"></i>AI Recommendations:
                    </h3>
                    <ul class="text-sm text-yellow-700 space-y-1" id="recommendations">
                        <li>• Eat protein within 30 minutes post-workout</li>
                        <li>• Spread protein intake evenly throughout the day</li>
                        <li>• Focus on complex carbs around workouts</li>
                        <li>• Include healthy fats with each meal</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Macro Tracker Section -->
        <div class="mt-8 bg-white rounded-lg shadow-lg p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">
                    <i class="fas fa-chart-line mr-2"></i>Daily Macro Tracker
                </h2>
                <div class="flex gap-2">
                    <button onclick="loadTodayMeals()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm">
                        <i class="fas fa-history mr-1"></i>Load Meals
                    </button>
                    <button onclick="resetTracker()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm">
                        <i class="fas fa-redo mr-1"></i>Reset Day
                    </button>
                </div>
            </div>

            <!-- Daily Achievement Label -->
            <div class="flex justify-center mb-4">
                <div class="bg-blue-50 border border-blue-200 rounded-full px-4 py-2">
                    <span class="text-blue-700 font-medium text-sm">
                        <i class="fas fa-target mr-1"></i>Daily Progress: 
                        <span id="dailyProgress" class="font-bold">0%</span>
                    </span>
                </div>
            </div>

            <!-- Progress Bars -->
            <div class="grid grid-cols-1 gap-3 md:grid-cols-2 lg:grid-cols-4 md:gap-4 mb-6">
                <!-- Calories Bar -->
                <div class="bg-blue-50 p-3 sm:p-4 rounded-lg">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-medium text-blue-700">Calories</span>
                        <span class="text-sm text-blue-600" id="caloriesProgress">0 / 2000</span>
                    </div>
                    <div class="w-full bg-blue-200 rounded-full h-3">
                        <div class="bg-blue-500 h-3 rounded-full transition-all duration-300" id="caloriesBar" style="width: 0%"></div>
                    </div>
                </div>
                
                <div class="bg-red-50 p-3 sm:p-4 rounded-lg">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-medium text-red-700">Protein</span>
                        <span class="text-sm text-red-600" id="proteinProgress">0g / 150g</span>
                    </div>
                    <div class="w-full bg-red-200 rounded-full h-3">
                        <div class="bg-red-500 h-3 rounded-full transition-all duration-300" id="proteinBar" style="width: 0%"></div>
                    </div>
                </div>
                <div class="bg-green-50 p-3 sm:p-4 rounded-lg">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-medium text-green-700">Carbs</span>
                        <span class="text-sm text-green-600" id="carbsProgress">0g / 250g</span>
                    </div>
                    <div class="w-full bg-green-200 rounded-full h-3">
                        <div class="bg-green-500 h-3 rounded-full transition-all duration-300" id="carbsBar" style="width: 0%"></div>
                    </div>
                </div>
                <div class="bg-yellow-50 p-3 sm:p-4 rounded-lg">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-medium text-yellow-700">Fat</span>
                        <span class="text-sm text-yellow-600" id="fatProgress">0g / 67g</span>
                    </div>
                    <div class="w-full bg-yellow-200 rounded-full h-3">
                        <div class="bg-yellow-500 h-3 rounded-full transition-all duration-300" id="fatBar" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- Add Meal Form -->
            <div class="bg-gray-50 p-4 rounded-lg mb-6">
                <h3 class="font-bold text-gray-800 mb-4">Add Meal</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-6 gap-2 sm:gap-4">
                    <input type="text" id="mealName" placeholder="Meal name" class="p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500">
                    <input type="number" id="mealCalories" placeholder="Calories" class="p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500" step="1">
                    <input type="number" id="mealProtein" placeholder="Protein (g)" class="p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500" step="0.1">
                    <input type="number" id="mealCarbs" placeholder="Carbs (g)" class="p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500" step="0.1">
                    <input type="number" id="mealFat" placeholder="Fat (g)" class="p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500" step="0.1">
                    <button onclick="addMeal()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded font-medium">
                        <i class="fas fa-plus mr-1"></i>Add
                    </button>
                </div>
            </div>

            <!-- Meals List -->
            <div id="mealsList" class="space-y-3">
                <!-- Meals will be added here dynamically -->
            </div>
        </div>

        <!-- Meal Planning Section -->
        <div class="mt-8 bg-white rounded-lg shadow-lg p-6">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                <h2 class="text-2xl font-bold text-gray-800">
                    <i class="fas fa-calendar-alt mr-2"></i>Weekly Meal Planner
                </h2>
                <div class="flex flex-wrap gap-2">
                    <button onclick="exportMealPlanPDF()" class="bg-blue-500 hover:bg-blue-600 text-white px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm">
                        <i class="fas fa-file-pdf mr-1"></i><span class="hidden xs:inline">Export </span>PDF
                    </button>
                    <button onclick="exportMealPlanCSV()" class="bg-green-500 hover:bg-green-600 text-white px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm">
                        <i class="fas fa-file-csv mr-1"></i><span class="hidden xs:inline">Export </span>CSV
                    </button>
                    <!-- Grocery List Export Dropdown -->
                    <div class="relative inline-block">
                        <button onclick="toggleGroceryDropdown()" class="bg-purple-500 hover:bg-purple-600 text-white px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm flex items-center">
                            <i class="fas fa-shopping-cart mr-1"></i>Grocery List <i class="fas fa-chevron-down ml-1"></i>
                        </button>
                        <div id="groceryDropdown" class="hidden absolute right-0 sm:right-0 mt-1 w-40 sm:w-48 bg-white border border-gray-200 rounded-lg shadow-lg z-50 max-w-xs">
                            <button onclick="exportGroceryList('pdf')" class="w-full text-left px-3 sm:px-4 py-2 hover:bg-gray-100 flex items-center text-xs sm:text-sm">
                                <i class="fas fa-file-pdf mr-2 text-red-600 text-sm"></i>
                                <span class="truncate">Professional PDF</span>
                            </button>
                            <button onclick="exportGroceryList('html')" class="w-full text-left px-3 sm:px-4 py-2 hover:bg-gray-100 flex items-center text-xs sm:text-sm">
                                <i class="fas fa-globe mr-2 text-blue-600 text-sm"></i>
                                <span class="truncate">Web Format</span>
                            </button>
                        </div>
                    </div>
                    <button onclick="clearMealPlan()" class="bg-red-500 hover:bg-red-600 text-white px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm">
                        <i class="fas fa-trash mr-1"></i><span class="hidden xs:inline">Clear </span>Plan
                    </button>
                </div>
            </div>

            <!-- Day Selection -->
            <div class="flex flex-wrap gap-1 sm:gap-2 mb-6 justify-center sm:justify-start">
                <button onclick="selectDay('monday')" id="btn-monday" class="day-btn bg-blue-100 hover:bg-blue-200 text-blue-800 px-4 py-2 rounded-lg font-medium transition-colors">Monday</button>
                <button onclick="selectDay('tuesday')" id="btn-tuesday" class="day-btn bg-blue-100 hover:bg-blue-200 text-blue-800 px-4 py-2 rounded-lg font-medium transition-colors">Tuesday</button>
                <button onclick="selectDay('wednesday')" id="btn-wednesday" class="day-btn bg-blue-100 hover:bg-blue-200 text-blue-800 px-4 py-2 rounded-lg font-medium transition-colors">Wednesday</button>
                <button onclick="selectDay('thursday')" id="btn-thursday" class="day-btn bg-blue-100 hover:bg-blue-200 text-blue-800 px-4 py-2 rounded-lg font-medium transition-colors">Thursday</button>
                <button onclick="selectDay('friday')" id="btn-friday" class="day-btn bg-blue-100 hover:bg-blue-200 text-blue-800 px-4 py-2 rounded-lg font-medium transition-colors">Friday</button>
                <button onclick="selectDay('saturday')" id="btn-saturday" class="day-btn bg-blue-100 hover:bg-blue-200 text-blue-800 px-4 py-2 rounded-lg font-medium transition-colors">Saturday</button>
                <button onclick="selectDay('sunday')" id="btn-sunday" class="day-btn bg-blue-100 hover:bg-blue-200 text-blue-800 px-4 py-2 rounded-lg font-medium transition-colors">Sunday</button>
            </div>

            <!-- Current Day Display -->
            <div class="bg-gradient-to-r from-purple-50 to-blue-50 p-4 rounded-lg mb-6">
                <h3 class="text-lg font-bold text-gray-800 mb-2">Planning for: <span id="currentDay" class="text-blue-600">Monday</span></h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- Breakfast -->
                    <div class="bg-white p-4 rounded-lg border">
                        <h4 class="font-bold text-orange-600 mb-3"><i class="fas fa-sun mr-2"></i>Breakfast</h4>
                        <div class="space-y-2 mb-3">
                            <input type="text" id="breakfast-meal" placeholder="Meal name" class="w-full p-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-orange-500">
                            <div class="grid grid-cols-2 gap-2">
                                <input type="number" id="breakfast-calories" placeholder="Calories" class="p-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-orange-500" step="1">
                                <input type="number" id="breakfast-protein" placeholder="Protein (g)" class="p-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-orange-500" step="0.1">
                                <input type="number" id="breakfast-carbs" placeholder="Carbs (g)" class="p-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-orange-500" step="0.1">
                                <input type="number" id="breakfast-fat" placeholder="Fat (g)" class="p-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-orange-500" step="0.1">
                            </div>
                        </div>
                        <button onclick="addPlannedMeal('breakfast')" class="w-full py-2 px-3 rounded text-sm font-medium" style="background-color: #f97316 !important; color: white !important; border: none;">
                            <i class="fas fa-plus mr-1"></i>Add
                        </button>
                        <div id="breakfast-list" class="mt-3 space-y-1"></div>
                    </div>

                    <!-- Lunch -->
                    <div class="bg-white p-4 rounded-lg border">
                        <h4 class="font-bold text-green-600 mb-3"><i class="fas fa-sun mr-2"></i>Lunch</h4>
                        <div class="space-y-2 mb-3">
                            <input type="text" id="lunch-meal" placeholder="Meal name" class="w-full p-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-green-500">
                            <div class="grid grid-cols-2 gap-2">
                                <input type="number" id="lunch-calories" placeholder="Calories" class="p-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-green-500" step="1">
                                <input type="number" id="lunch-protein" placeholder="Protein (g)" class="p-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-green-500" step="0.1">
                                <input type="number" id="lunch-carbs" placeholder="Carbs (g)" class="p-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-green-500" step="0.1">
                                <input type="number" id="lunch-fat" placeholder="Fat (g)" class="p-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-green-500" step="0.1">
                            </div>
                        </div>
                        <button onclick="addPlannedMeal('lunch')" class="w-full bg-green-500 hover:bg-green-600 text-white py-2 px-3 rounded text-sm font-medium">
                            <i class="fas fa-plus mr-1"></i>Add
                        </button>
                        <div id="lunch-list" class="mt-3 space-y-1"></div>
                    </div>

                    <!-- Dinner -->
                    <div class="bg-white p-4 rounded-lg border">
                        <h4 class="font-bold text-purple-600 mb-3"><i class="fas fa-moon mr-2"></i>Dinner</h4>
                        <div class="space-y-2 mb-3">
                            <input type="text" id="dinner-meal" placeholder="Meal name" class="w-full p-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-purple-500">
                            <div class="grid grid-cols-2 gap-2">
                                <input type="number" id="dinner-calories" placeholder="Calories" class="p-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-purple-500" step="1">
                                <input type="number" id="dinner-protein" placeholder="Protein (g)" class="p-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-purple-500" step="0.1">
                                <input type="number" id="dinner-carbs" placeholder="Carbs (g)" class="p-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-purple-500" step="0.1">
                                <input type="number" id="dinner-fat" placeholder="Fat (g)" class="p-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-purple-500" step="0.1">
                            </div>
                        </div>
                        <button onclick="addPlannedMeal('dinner')" class="w-full bg-purple-500 hover:bg-purple-600 text-white py-2 px-3 rounded text-sm font-medium">
                            <i class="fas fa-plus mr-1"></i>Add
                        </button>
                        <div id="dinner-list" class="mt-3 space-y-1"></div>
                    </div>

                    <!-- Dynamic Custom Sections Container -->
                    <div id="customSectionsContainer"></div>

                    <!-- Add Custom Section Bar (appears below existing custom sections) -->
                    <div id="addCustomSectionBar" class="bg-white p-4 rounded-lg border">
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="font-bold text-gray-800"><i class="fas fa-plus-circle mr-2"></i>Add Custom Section</h4>
                            <button id="toggleAddCustomBtn" onclick="toggleAddCustomSection()" class="bg-blue-500 hover:bg-blue-600 text-white py-1 px-3 rounded text-sm">
                                <i class="fas fa-plus mr-1"></i>Add
                            </button>
                        </div>
                        
                        <!-- Custom Section Name Input -->
                        <div id="customSectionConfig" class="hidden">
                            <div class="mb-3">
                                <input type="text" id="customSectionName" placeholder="Section name (e.g., Snacks, Drinks, Supplements)" class="w-full p-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500" maxlength="20">
                            </div>
                            <div class="flex gap-2">
                                <button onclick="createCustomSection()" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-2 px-3 rounded text-sm font-medium">
                                    <i class="fas fa-check mr-1"></i>Create Section
                                </button>
                                <button onclick="cancelAddCustomSection()" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-3 rounded text-sm font-medium">
                                    <i class="fas fa-times mr-1"></i>Cancel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Daily Summary for Selected Day -->
                <div class="mt-4 bg-white p-4 rounded-lg border">
                    <h4 class="font-bold text-gray-800 mb-2">Daily Summary</h4>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4 text-center mb-3">
                        <div>
                            <div class="text-lg font-bold text-blue-600" id="planned-calories">0</div>
                            <div class="text-sm text-gray-600">Calories</div>
                        </div>
                        <div>
                            <div class="text-lg font-bold text-red-500" id="planned-protein">0g</div>
                            <div class="text-sm text-gray-600">Protein</div>
                        </div>
                        <div>
                            <div class="text-lg font-bold text-green-600" id="planned-carbs">0g</div>
                            <div class="text-sm text-gray-600">Carbs</div>
                        </div>
                        <div>
                            <div class="text-lg font-bold text-yellow-600" id="planned-fat">0g</div>
                            <div class="text-sm text-gray-600">Fat</div>
                        </div>
                        <div>
                            <div class="text-lg font-bold text-gray-500" id="planned-meals">0</div>
                            <div class="text-sm text-gray-600">Meals</div>
                        </div>
                        <div>
                            <button onclick="copyToTracker()" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm font-medium">
                                <i class="fas fa-copy mr-1"></i>Copy to Tracker
                            </button>
                        </div>
                    </div>
                </div>
            </div>


        </div>

        <!-- Recipe Database Section -->
        <div class="mt-8 bg-white rounded-lg shadow-lg p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">
                    <i class="fas fa-book mr-2"></i>Recipe Database
                </h2>
                <div class="flex gap-2">
                    <button onclick="toggleAddRecipeForm()" id="addRecipeToggle" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm">
                        <i class="fas fa-plus mr-1"></i>Add Recipe
                    </button>
                    <button onclick="clearCustomRecipes()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm">
                        <i class="fas fa-trash mr-1"></i>Clear Custom
                    </button>
                </div>
            </div>

            <!-- Search and Filter -->
            <div class="grid grid-cols-1 gap-3 md:grid-cols-3 md:gap-4 mb-6">
                <input type="text" id="recipeSearch" placeholder="Search recipes..." class="p-2 sm:p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 w-full" onkeyup="filterRecipes()">
                <select id="recipeFilter" class="p-2 sm:p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 w-full" onchange="filterRecipes()">
                    <option value="">All Categories</option>
                    <option value="breakfast">Breakfast</option>
                    <option value="lunch">Lunch</option>
                    <option value="dinner">Dinner</option>
                    <option value="snack">Snack</option>
                    <option value="custom">Custom Recipes</option>
                </select>
                <select id="caloryRange" class="p-2 sm:p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 w-full" onchange="filterRecipes()">
                    <option value="">All Calories</option>
                    <option value="0-300">Under 300 cal</option>
                    <option value="300-500">300-500 cal</option>
                    <option value="500-700">500-700 cal</option>
                    <option value="700+">700+ cal</option>
                </select>
            </div>

            <!-- Add Recipe Form (Hidden by default) -->
            <div id="addRecipeForm" class="bg-gray-50 p-6 rounded-lg mb-6 hidden">
                <h3 class="text-lg font-bold text-gray-800 mb-4">Add Your Own Recipe</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <input type="text" id="newRecipeName" placeholder="Recipe Name" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                    <select id="newRecipeCategory" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                        <option value="breakfast">Breakfast</option>
                        <option value="lunch">Lunch</option>
                        <option value="dinner">Dinner</option>
                        <option value="snack">Snack</option>
                    </select>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                    <input type="number" id="newRecipeCalories" placeholder="Calories" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" step="1">
                    <input type="number" id="newRecipeProtein" placeholder="Protein (g)" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" step="0.1">
                    <input type="number" id="newRecipeCarbs" placeholder="Carbs (g)" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" step="0.1">
                    <input type="number" id="newRecipeFat" placeholder="Fat (g)" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" step="0.1">
                </div>
                <input type="text" id="newRecipeServings" placeholder="Serving Size (e.g., 1 bowl, 2 pieces)" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 mb-4">
                <textarea id="newRecipeIngredients" placeholder="Ingredients (one per line)" rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 mb-4"></textarea>
                <textarea id="newRecipeInstructions" placeholder="Cooking Instructions" rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 mb-4"></textarea>
                <div class="flex gap-2">
                    <button onclick="saveCustomRecipe()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium">
                        <i class="fas fa-save mr-2"></i>Save Recipe
                    </button>
                    <button onclick="toggleAddRecipeForm()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium">
                        Cancel
                    </button>
                </div>
            </div>

            <!-- Recipe Cards Container -->
            <div id="recipesContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Recipes will be populated here -->
            </div>

            <!-- Show More/Less Button -->
            <div id="showMoreContainer" class="text-center mt-6 hidden">
                <button id="showMoreBtn" onclick="toggleRecipeDisplay()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                    <i class="fas fa-chevron-down mr-2"></i>Show More Recipes (<span id="hiddenCount">0</span> hidden)
                </button>
            </div>

            <!-- No Results Message -->
            <div id="noResults" class="text-center py-8 hidden">
                <i class="fas fa-search text-4xl text-gray-300 mb-4"></i>
                <p class="text-gray-500 text-lg">No recipes found matching your criteria.</p>
            </div>
        </div>

        <!-- Progress Tracker Dashboard -->
        <div class="mt-8 bg-white rounded-lg shadow-lg p-6">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                <h2 class="text-2xl font-bold text-gray-800">
                    <i class="fas fa-chart-line mr-2"></i>Progress Tracker Dashboard
                </h2>
                <div class="flex flex-wrap gap-2">
                    <!-- Direct Export Buttons -->
                    <button onclick="exportProgressPDF()" class="bg-red-500 hover:bg-red-600 text-white px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm flex items-center">
                        <i class="fas fa-file-pdf mr-1"></i>PDF Report
                    </button>
                    <button onclick="exportProgressCSV()" class="bg-green-500 hover:bg-green-600 text-white px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm flex items-center">
                        <i class="fas fa-file-csv mr-1"></i>CSV Data
                    </button>
                    <button onclick="clearAllProgressData()" class="bg-red-500 hover:bg-red-600 text-white px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm">
                        <i class="fas fa-trash mr-1"></i>Clear
                    </button>
                </div>
            </div>

            <!-- Quick Stats Overview -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4 mb-6">
                <div class="bg-gradient-to-r from-blue-50 to-blue-100 p-3 sm:p-4 rounded-lg text-center">
                    <div class="text-lg sm:text-2xl font-bold text-blue-600" id="currentWeight">--</div>
                    <div class="text-xs sm:text-sm text-blue-700">Current Weight</div>
                    <div class="text-xs text-blue-600 mt-1" id="weightChange">No data</div>
                </div>
                <div class="bg-gradient-to-r from-green-50 to-green-100 p-3 sm:p-4 rounded-lg text-center">
                    <div class="text-lg sm:text-2xl font-bold text-green-600" id="totalProgressEntries">0</div>
                    <div class="text-xs sm:text-sm text-green-700">Entries</div>
                    <div class="text-xs text-green-600 mt-1" id="daysSinceStart">0 days</div>
                </div>
                <div class="bg-gradient-to-r from-purple-50 to-purple-100 p-3 sm:p-4 rounded-lg text-center">
                    <div class="text-lg sm:text-2xl font-bold text-purple-600" id="goalProgressPercent">0%</div>
                    <div class="text-xs sm:text-sm text-purple-700">Goal Progress</div>
                    <div class="text-xs text-purple-600 mt-1" id="goalStatusText">Set goal</div>
                </div>
                <div class="bg-gradient-to-r from-orange-50 to-orange-100 p-3 sm:p-4 rounded-lg text-center">
                    <div class="text-lg sm:text-2xl font-bold text-orange-600" id="weeklyAverage">--</div>
                    <div class="text-xs sm:text-sm text-orange-700">Weekly Avg</div>
                    <div class="text-xs text-orange-600 mt-1">Change</div>
                </div>
            </div>

            <!-- Add Progress Entry Form -->
            <div class="bg-gray-50 p-4 rounded-lg mb-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4">
                    <i class="fas fa-plus mr-2"></i>Add Progress Entry
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-6 gap-3 sm:gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                        <input type="date" id="progressEntryDate" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label for="progressEntryWeight" class="block text-sm font-medium text-gray-700 mb-1">Weight (lbs)</label>
                        <input type="number" id="progressEntryWeight" placeholder="150.0" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" step="0.1">
                    </div>
                    <div>
                        <label for="progressEntryWaist" class="block text-sm font-medium text-gray-700 mb-1">Waist (in)</label>
                        <input type="number" id="progressEntryWaist" placeholder="32.0" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" step="0.1">
                    </div>
                    <div>
                        <label for="progressEntryChest" class="block text-sm font-medium text-gray-700 mb-1">Chest (in)</label>
                        <input type="number" id="progressEntryChest" placeholder="38.0" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" step="0.1">
                    </div>
                    <div>
                        <label for="progressEntryHips" class="block text-sm font-medium text-gray-700 mb-1">Hips (in)</label>
                        <input type="number" id="progressEntryHips" placeholder="36.0" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" step="0.1">
                    </div>
                    <div>
                        <label for="progressEntryArms" class="block text-sm font-medium text-gray-700 mb-1">Arms (in)</label>
                        <input type="number" id="progressEntryArms" placeholder="13.0" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" step="0.1">
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Notes (Optional)</label>
                    <textarea id="progressEntryNotes" placeholder="How are you feeling? Any observations..." rows="2" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"></textarea>
                </div>
                <button onclick="saveProgressEntry()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium">
                    <i class="fas fa-save mr-2"></i>Save Entry
                </button>
            </div>

            <!-- Goal Setting -->
            <div class="bg-gradient-to-r from-indigo-50 to-purple-50 p-4 rounded-lg mb-6">
                <h3 class="text-lg font-bold text-gray-800 mb-3">
                    <i class="fas fa-target mr-2"></i>Set Weight Goal
                </h3>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                    <div>
                        <label for="targetWeight" class="block text-sm font-medium text-gray-700 mb-1">Target Weight (lbs)</label>
                        <input type="number" id="targetWeight" placeholder="150" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" step="0.1">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Target Date</label>
                        <input type="date" id="targetDate" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div class="flex items-end">
                        <button onclick="setProgressGoal()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium">
                            <i class="fas fa-bullseye mr-1"></i>Set Goal
                        </button>
                    </div>
                </div>
            </div>

            <!-- Progress Chart -->
            <div class="bg-gray-50 p-4 rounded-lg mb-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4">
                    <i class="fas fa-weight mr-2"></i>Weight Progress Chart
                </h3>
                <div style="height: 300px; position: relative;">
                    <canvas id="progressWeightChart"></canvas>
                </div>
            </div>

            <!-- Macro Nutrition Progress -->
            <div class="bg-gradient-to-r from-green-50 to-blue-50 p-4 rounded-lg mb-6">
                <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-4 gap-3 sm:gap-0">
                    <div class="flex-1">
                        <h3 class="text-lg font-bold text-gray-800">
                            <i class="fas fa-chart-bar mr-2"></i>Macro Nutrition Progress (Last 7 Days)
                        </h3>
                        <p class="text-xs text-gray-600 mt-1">
                            <i class="fas fa-info-circle mr-1"></i>Automatically tracks your daily macro intake from the Daily Macro Tracker above
                        </p>
                    </div>
                    <div class="flex flex-col sm:flex-row gap-2 sm:gap-2 w-full sm:w-auto">
                        <button onclick="refreshMacroProgress()" class="bg-blue-500 hover:bg-blue-600 active:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 flex items-center justify-center sm:justify-start shadow-sm hover:shadow-md" title="Refresh macro progress data">
                            <i class="fas fa-sync-alt mr-2"></i>Refresh
                        </button>
                        <button onclick="clearMacroProgress()" class="bg-red-500 hover:bg-red-600 active:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 flex items-center justify-center sm:justify-start shadow-sm hover:shadow-md" title="Clear all macro progress data">
                            <i class="fas fa-trash-alt mr-2"></i>Clear Data
                        </button>
                    </div>
                </div>
                
                <!-- Macro Stats Overview -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-white p-4 rounded-lg text-center shadow-sm">
                        <div class="text-2xl font-bold text-red-600" id="avgProtein">0g</div>
                        <div class="text-sm text-red-700">Avg Protein</div>
                        <div class="text-xs text-red-600 mt-1" id="proteinTrend">No trend</div>
                    </div>
                    <div class="bg-white p-4 rounded-lg text-center shadow-sm">
                        <div class="text-2xl font-bold text-yellow-600" id="avgCarbs">0g</div>
                        <div class="text-sm text-yellow-700">Avg Carbs</div>
                        <div class="text-xs text-yellow-600 mt-1" id="carbsTrend">No trend</div>
                    </div>
                    <div class="bg-white p-4 rounded-lg text-center shadow-sm">
                        <div class="text-2xl font-bold text-green-600" id="avgFat">0g</div>
                        <div class="text-sm text-green-700">Avg Fat</div>
                        <div class="text-xs text-green-600 mt-1" id="fatTrend">No trend</div>
                    </div>
                </div>

                <!-- Macro Trend Charts -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Daily Macro Totals Chart -->
                    <div class="bg-white p-4 rounded-lg shadow-sm">
                        <h4 class="font-semibold text-gray-800 mb-3">Daily Macro Totals</h4>
                        <div style="height: 200px; position: relative;">
                            <canvas id="macroTotalsChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- Macro Goals Achievement Chart -->
                    <div class="bg-white p-4 rounded-lg shadow-sm">
                        <h4 class="font-semibold text-gray-800 mb-3">Goal Achievement %</h4>
                        <div style="height: 200px; position: relative;">
                            <canvas id="macroGoalsChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Macro Progress Table -->
                <div class="mt-6 bg-white rounded-lg shadow-sm overflow-hidden">
                    <h4 class="font-semibold text-gray-800 p-4 border-b">Recent Daily Macro Summary</h4>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="text-left p-3 font-medium text-gray-700">Date</th>
                                    <th class="text-center p-3 font-medium text-gray-700">Calories</th>
                                    <th class="text-center p-3 font-medium text-red-700">Protein</th>
                                    <th class="text-center p-3 font-medium text-yellow-700">Carbs</th>
                                    <th class="text-center p-3 font-medium text-green-700">Fat</th>
                                    <th class="text-center p-3 font-medium text-gray-700">Goal Met</th>
                                </tr>
                            </thead>
                            <tbody id="macroHistoryTable">
                                <tr>
                                    <td colspan="6" class="text-center py-8 text-gray-500">
                                        <i class="fas fa-chart-line text-2xl mb-2"></i>
                                        <p>Start tracking daily macros to see your progress here!</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Progress Timeline -->
            <div class="bg-gray-50 p-4 rounded-lg mb-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4">
                    <i class="fas fa-history mr-2"></i>Recent Entries
                </h3>
                <div class="max-h-64 overflow-y-auto" id="progressTimeline">
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-chart-line text-4xl mb-4"></i>
                        <p>No progress entries yet. Add your first entry above to start tracking!</p>
                    </div>
                </div>
            </div>

            <!-- Latest Measurements -->
            <div class="bg-gray-50 p-4 rounded-lg">
                <h3 class="text-lg font-bold text-gray-800 mb-4">
                    <i class="fas fa-ruler mr-2"></i>Latest Measurements
                </h3>
                <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                    <div class="text-center p-3 bg-white rounded-lg">
                        <div class="text-sm font-medium text-gray-600">Waist</div>
                        <div class="text-lg font-bold text-gray-800" id="latestWaist">--</div>
                        <div class="text-xs text-gray-500 unit-label">inches</div>
                    </div>
                    <div class="text-center p-3 bg-white rounded-lg">
                        <div class="text-sm font-medium text-gray-600">Chest</div>
                        <div class="text-lg font-bold text-gray-800" id="latestChest">--</div>
                        <div class="text-xs text-gray-500 unit-label">inches</div>
                    </div>
                    <div class="text-center p-3 bg-white rounded-lg">
                        <div class="text-sm font-medium text-gray-600">Hips</div>
                        <div class="text-lg font-bold text-gray-800" id="latestHips">--</div>
                        <div class="text-xs text-gray-500 unit-label">inches</div>
                    </div>
                    <div class="text-center p-3 bg-white rounded-lg">
                        <div class="text-sm font-medium text-gray-600">Arms</div>
                        <div class="text-lg font-bold text-gray-800" id="latestArms">--</div>
                        <div class="text-xs text-gray-500 unit-label">inches</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End of App Section -->



    
  
  

<script>
  document.addEventListener('DOMContentLoaded', async () => {
    try {
      await authWrapper.init();
      await authWrapper.requireAuthOrRedirect('index.html');

      // Live session check every 60s
      setInterval(async () => {
        const session = await authWrapper.getSession();
        if (!session) {
          console.warn("Session expired, redirecting to login...");
          location.href = 'index.html';
        }
      }, 60000);

      // Redirect immediately if logout triggered
      authWrapper.on('logout', () => {
        console.warn("User logged out, redirecting to login...");
        location.href = 'index.html';
      });
    } catch (err) {
      console.error("Auth initialization error:", err);
      location.href = 'index.html';
    }
  });
</script>

<!-- Unified Supabase Auth System -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabase-config.js"></script>
<script src="auth-manager.js"></script>
<script>
  // Safe InitializationManager wrapper (singleton guard)
  if (!window.InitializationManager) {
    class InitializationManager {
      constructor() {
        if (window.initManager) return window.initManager;
        window.initManager = this;
        this.ready = false;
      }
    }
    window.InitializationManager = InitializationManager;
  }
  if (!window.initManager) window.initManager = new window.InitializationManager();
</script>
<script src="initialization-manager.js"></script>
<script src="security-middleware.js"></script>

</body>
</html>`;
            
            return html;
        }

        // Generate CSV grocery list
        function generateGroceryListCSV(ingredientsList, mealsByDay, totalMeals, totalCalories) {
            let csv = 'Category,Item,Quantity,Unit,Usage Count\\n';
            
            const storeCategories = getStoreCategories(ingredientsList);
            
            Object.entries(storeCategories).forEach(([categoryName, category]) => {
                if (category.items.length > 0) {
                    const cleanCategoryName = categoryName.replace(/🥩|🥬|🥛|🍞|🌾|🥫|❄️|🧂|🥤|🛒/g, '').trim();
                    
                    category.items.sort((a, b) => a.name.localeCompare(b.name));
                    category.items.forEach(item => {
                        csv += `"${cleanCategoryName}","${item.name}","${item.quantity}","${item.unit}","${item.count}"\\n`;
                    });
                }
            });
            
            return csv;
        }

        // Helper function to organize ingredients by store categories
        function getStoreCategories(ingredientsList) {
            const storeCategories = {
                '🥩 MEAT & SEAFOOD': {
                    keywords: ['chicken', 'beef', 'fish', 'turkey', 'pork', 'salmon', 'tuna', 'shrimp', 'lamb', 'ground beef', 'steak'],
                    items: []
                },
                '🥬 FRESH PRODUCE': {
                    keywords: ['lettuce', 'tomato', 'onion', 'pepper', 'broccoli', 'spinach', 'carrot', 'cucumber', 'avocado', 'garlic', 'ginger', 'herb', 'vegetable', 'apple', 'banana', 'berry', 'fruit', 'orange', 'lemon', 'lime'],
                    items: []
                },
                '🥛 DAIRY & EGGS': {
                    keywords: ['milk', 'cheese', 'yogurt', 'butter', 'cream', 'egg', 'dairy'],
                    items: []
                },
                '🍞 BAKERY & BREAD': {
                    keywords: ['bread', 'bagel', 'roll', 'bun', 'croissant', 'muffin', 'pastry'],
                    items: []
                },
                '🌾 GRAINS & PASTA': {
                    keywords: ['rice', 'pasta', 'noodle', 'quinoa', 'oat', 'cereal', 'flour', 'grain'],
                    items: []
                },
                '🥫 CANNED GOODS': {
                    keywords: ['canned', 'jar', 'sauce', 'soup', 'broth', 'stock'],
                    items: []
                },
                '❄️ FROZEN FOODS': {
                    keywords: ['frozen', 'ice cream'],
                    items: []
                },
                '🧂 SPICES & CONDIMENTS': {
                    keywords: ['salt', 'pepper', 'spice', 'seasoning', 'oil', 'vinegar', 'mayo', 'mustard', 'ketchup'],
                    items: []
                },
                '🥤 BEVERAGES': {
                    keywords: ['juice', 'soda', 'water', 'tea', 'coffee', 'drink'],
                    items: []
                },
                '🛒 OTHER ITEMS': {
                    keywords: [],
                    items: []
                }
            };
            
            // Categorize ingredients
            Object.values(ingredientsList).forEach(ingredient => {
                const lower = ingredient.name.toLowerCase();
                let categorized = false;
                
                for (const [categoryName, category] of Object.entries(storeCategories)) {
                    if (categoryName === '🛒 OTHER ITEMS') continue;
                    
                    if (category.keywords.some(keyword => lower.includes(keyword))) {
                        category.items.push(ingredient);
                        categorized = true;
                        break;
                    }
                }
                
                if (!categorized) {
                    storeCategories['🛒 OTHER ITEMS'].items.push(ingredient);
                }
            });
            
            return storeCategories;
        }

        // Global chart variables
        let allChartsInitialized = false;

        // Destroy existing chart if it exists
        function destroyChart(chartVariable) {
            if (chartVariable && typeof chartVariable.destroy === 'function') {
                try {
                    chartVariable.destroy();
                } catch (error) {
                    console.warn('Error destroying chart:', error);
                }
            }
            return null;
        }

        // Unified chart initialization function
        function initializeAllCharts() {
            console.log('Initializing all charts...');
            
            // Destroy existing charts first
            charts.calories = destroyChart(charts.calories);
            charts.protein = destroyChart(charts.protein);
            charts.carbs = destroyChart(charts.carbs);
            charts.fat = destroyChart(charts.fat);
            progressChart = destroyChart(progressChart);
            macroTotalsChart = destroyChart(macroTotalsChart);
            macroGoalsChart = destroyChart(macroGoalsChart);
            
            // Initialize macro doughnut charts
            initializeMacroDoughnutCharts();
            
            // Initialize progress chart
            initializeProgressChart();
            
            // Initialize macro line charts
            initializeMacroCharts();
        }
        
        // Application Initialization (Protected by Cloudflare Access)
        async function initializeApp() {
            console.log('Initializing Macro Calculator (Protected by Cloudflare Access)...');
            
            // Check authentication for invite-only system
            try {
                const authState = await window.authHelper.getAuthState();
                if (!authState.isAuthenticated) {
                    console.warn('User not authenticated - redirecting to login');
                    window.authHelper.redirectToLogin();
                    return; // Stop initialization
                }
                console.info('✅ User authenticated, proceeding with app initialization');
            } catch (error) {
                console.error('Authentication check failed:', error);
                window.authHelper.redirectToLogin();
                return;
            }
            
            // Clean up any old authentication session data
            localStorage.removeItem('macro_auth_session');
            
            // Check if Chart.js is loaded
            if (typeof Chart === 'undefined') {
                console.error('Chart.js is not loaded! Charts will not work.');
                showNotification('Charts Error', 'Chart.js library failed to load. Charts will not work.', 'error');
                return;
            } else {
                console.log('Chart.js version:', Chart.version);
            }
            
            // Initialize in proper order with delays
            initializeUnitSystem();
            
            setTimeout(async () => {
                // Load basic data first (without database calls)
                await loadBasicStoredData();
                initializeRecipeDatabase();
                initializeProgressTracker();
                initializeMacroTracking();
                
                // Load weekly meal planner data
                loadMealPlan().catch(error => console.warn('Meal plan load error:', error));
                
                // Check for and restore final backup if needed
                checkForFinalBackup();
            }, 100);
            
            setTimeout(() => {
                initializeAllCharts();
                updateProgress();
                allChartsInitialized = true;
                
                // Setup auto-save mechanism
                setupAutoSave();
                
                // Verify data integrity
                verifyDataIntegrity();
                
                // Ensure display is synchronized with saved/calculated values
                ensureDisplaySync();
                
                // Ensure meal displays are properly updated after initialization
                refreshMealDisplays();
                
                // Save data before page unload
                window.addEventListener('beforeunload', function(event) {
                    console.log('Page unloading - saving progress data...');
                    saveProgressData();
                    
                    // Create final backup
                    try {
                        const finalBackup = {
                            progressEntries: progressEntries,
                            progressGoal: progressGoal,
                            timestamp: Date.now(),
                            finalSave: true
                        };
                        localStorage.setItem('progress_final_backup', JSON.stringify(finalBackup));
                    } catch (error) {
                        console.error('Error creating final backup:', error);
                    }
                });
                
                console.log('All app components initialized successfully');
            }, 500);
        }
        
        // Global error handlers
        window.addEventListener('error', function(event) {
            console.error('Global error caught:', event.error);
            // Only show user-friendly notifications for critical errors
            if (event.error && event.error.message && !event.error.message.includes('Loading CSS chunk')) {
                showNotification('Application Error', 'An unexpected error occurred. Please refresh the page if issues persist.', 'error');
            }
        });
        
        window.addEventListener('unhandledrejection', function(event) {
            console.error('Unhandled promise rejection:', event.reason);
            // Prevent the default behavior which would log to console
            event.preventDefault();
            // Only show notifications for non-trivial errors
            if (event.reason && event.reason.toString().includes('fetch')) {
                console.warn('Network request failed:', event.reason);
            }
        });
        
        // Initialize application on page load (Protected by Cloudflare Access)
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('DOM Content Loaded - Starting Macro Calculator (Protected by Cloudflare Access)...');
            

            
            await initializeApp();
        });
    </script>

    <!-- Stay Tuned Section -->
    <section class="bg-gradient-to-r from-blue-50 to-indigo-50 py-12 mt-12">
        <div class="max-w-4xl mx-auto px-4 text-center">
            <div class="bg-white rounded-lg shadow-lg p-8 border border-blue-100">
                <div class="flex items-center justify-center mb-4">
                    <svg class="w-8 h-8 text-blue-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <h2 class="text-2xl font-bold text-gray-800">Development in Progress</h2>
                </div>
                <p class="text-lg text-gray-600 mb-4">
                    🚀 <strong>Stay tuned for more features and recipes!</strong>
                </p>
                <p class="text-gray-500">
                    This macro calculator is continuously evolving. We're working on exciting new features, 
                    expanded recipe databases, and enhanced tracking capabilities to help you reach your nutrition goals.
                </p>
                <div class="flex items-center justify-center mt-6 space-x-2 text-sm text-blue-600">
                    <div class="animate-pulse flex space-x-1">
                        <div class="w-2 h-2 bg-blue-400 rounded-full"></div>
                        <div class="w-2 h-2 bg-blue-400 rounded-full"></div>
                        <div class="w-2 h-2 bg-blue-400 rounded-full"></div>
                    </div>
                    <span class="font-medium">More updates coming soon</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div class="md:col-span-2">
                    <h3 class="text-lg font-semibold mb-4">
                        <i class="fas fa-calculator mr-2"></i>
                        Macro Calculator
                    </h3>
                    <p class="text-gray-300 text-sm mb-4">Your AI-powered nutrition tracking companion. Track macros, monitor progress, and achieve your health goals with precision and ease.</p>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">Legal</h3>
                    <ul class="space-y-2 text-sm">
                        <li><a href="disclaimer.html" class="text-blue-400 hover:text-blue-300 transition-colors flex items-center">
                            <i class="fas fa-exclamation-triangle mr-2 w-4"></i>Disclaimer
                        </a></li>
                        <li><a href="privacy-policy.html" class="text-blue-400 hover:text-blue-300 transition-colors flex items-center">
                            <i class="fas fa-shield-alt mr-2 w-4"></i>Privacy Policy
                        </a></li>
                        <li><a href="terms-of-service.html" class="text-blue-400 hover:text-blue-300 transition-colors flex items-center">
                            <i class="fas fa-file-contract mr-2 w-4"></i>Terms of Service
                        </a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">Quick Access</h3>
                    <ul class="space-y-2 text-sm">
                        <li><a href="coach-login.html" class="text-green-400 hover:text-green-300 transition-colors flex items-center">
                            <i class="fas fa-dumbbell mr-2 w-4"></i>Coach Portal
                        </a></li>
                        <li><button onclick="handleAuth()" class="text-red-400 hover:text-red-300 transition-colors flex items-center">
                            <i class="fas fa-sign-out-alt mr-2 w-4"></i>Logout
                        </button></li>
                        <li><span class="text-gray-300 flex items-center">
                            <i class="fas fa-user mr-2 w-4"></i><span id="footer-user-name">User</span>
                        </span></li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-8">
                <div class="flex flex-col md:flex-row justify-between items-center text-sm text-gray-400">
                    <p>&copy; 2024 Macro Calculator. All rights reserved.</p>
                    <p class="mt-2 md:mt-0">Built with precision for your health journey.</p>
                </div>
            </div>
        </div>
    </footer>

<!-- Supabase Auth Widget -->




  
  

<script>
  document.addEventListener('DOMContentLoaded', async () => {
    try {
      await authWrapper.init();
      await authWrapper.requireAuthOrRedirect('index.html');

      // Live session check every 60s
      setInterval(async () => {
        const session = await authWrapper.getSession();
        if (!session) {
          console.warn("Session expired, redirecting to login...");
          location.href = 'index.html';
        }
      }, 60000);

      // Redirect immediately if logout triggered
      authWrapper.on('logout', () => {
        console.warn("User logged out, redirecting to login...");
        location.href = 'index.html';
      });
    } catch (err) {
      console.error("Auth initialization error:", err);
      location.href = 'index.html';
    }
  });
</script>

<!-- Unified Supabase Auth System -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabase-config.js"></script>
<script src="auth-manager.js"></script>
<script>
  // Safe InitializationManager wrapper (singleton guard)
  if (!window.InitializationManager) {
    class InitializationManager {
      constructor() {
        if (window.initManager) return window.initManager;
        window.initManager = this;
        this.ready = false;
      }
    }
    window.InitializationManager = InitializationManager;
  }
  if (!window.initManager) window.initManager = new window.InitializationManager();
</script>
<script src="initialization-manager.js"></script>
<script src="security-middleware.js"></script>

</body>
</html>
</script>
</script>